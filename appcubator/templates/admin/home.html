{% extends "admin/admin-base.html" %}
{% block content %}
  <p class="" id="yomomma"></p>
  <p class="" id="chucknorris"></p>
  <br>
	<div class="page-header">
		<h1>Users</h1>
	</div>
  <div class="row">
    <div class="span6">
      <h3>Active Users Today</h3>
      <!-- active users this week -->
      <table id="active-users-today" class="table table-striped table-hover table-bordered">
        <thead>
          <tr>
            <th data-sort-type="number">User ID</th>
            <th>Name</th>
            <th>Apps Deployed </th>
            <th>Page Views</th>
          </tr>
        </thead>
        <tbody>
          {% for obj in users_today %}
          <tr>
            <td><a href="{% url appcubator.admin_views.admin_user obj.user_id %}">{{ obj.user_id }}</a></td>
            <td><a href="{% url appcubator.admin_views.admin_user obj.user_id %}">{{ obj.name }}</a></td>
            <td>{{ obj.num_apps }}</td>
            <td>{{ obj.num_logs }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="span6">
      <h3>Active Users This Week</h3>
      <!-- active users this week -->
      <table id="active-users-week" class="table table-striped table-hover table-bordered">
        <thead>
          <tr>
            <th data-sort-type="number">User ID</th>
            <th>Name</th>
            <th>Apps Deployed</th>
            <th>Page Views</th>
          </tr>
        </thead>
        <tbody>
          {% for obj in users_last_week %}
          <tr>
            <td><a href="{% url appcubator.admin_views.admin_user obj.user_id %}">{{ obj.user_id }}</a></td>
            <td><a href="{% url appcubator.admin_views.admin_user obj.user_id %}">{{ obj.name }}</a></td>
            <td>{{ obj.num_apps }}</td>
            <td>{{ obj.num_logs }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="row">
    <div class="span6">
      <h3>Active Users This Month</h3>
      <!-- active users this week -->
      <table id="active-users-month" class="table table-striped table-hover table-bordered">
        <thead>
          <tr>
            <th data-sort-type="number">User ID</th>
            <th>Name</th>
            <th>Apps Deployed</th>
            <th>Page Views</th>
          </tr>
        </thead>
        <tbody>
          {% for obj in users_last_month %}
          <tr>
            <td><a href="{% url appcubator.admin_views.admin_user obj.user_id %}">{{ obj.user_id }}</a></td>
            <td><a href="{% url appcubator.admin_views.admin_user obj.user_id %}">{{ obj.name }}</a></td>
            <td>{{ obj.num_apps }}</td>
            <td>{{ obj.num_logs }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="span6">
      <h3>All-Time Most Active Users</h3>
      <!-- all-time most active users -->
      <table id="most-active-users" class="table table-striped table-hover table-bordered">
        <thead>
          <tr>
            <th data-sort-type="number">User ID</th>
            <th>Name</th>
            <th>Apps Deployed</th>
            <th>Page Views</th>
          </tr>
        </thead>
        <tbody>
          {% for obj in most_active_users %}
          <tr>
            <td><a href="{% url appcubator.admin_views.admin_user obj.user_id %}">{{ obj.user_id }}</a></td>
            <td><a href="{% url appcubator.admin_views.admin_user obj.user_id %}">{{ obj.user.user.first_name }} {{ obj.user.user.last_name }}</a></td>
            <td>{{ obj.num_apps }}</td>
            <td>{{ obj.num_logs }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>


  <div class="page-header">
		<h1>Deployment Stats</h1>
	</div>
  <p><strong>Avg. deploy time: </strong> {{avg_deployment_time}} seconds</p>
  <p><strong>Total deployed apps: </strong> {{ num_deployed_apps }}</p>
{% endblock %}

{% block js %}
<script type="text/javascript">
  $('#active-users-today').sortableTable({initialColumn: 4});
  $('#active-users-month').sortableTable({initialColumn: 4});
	$('#active-users-week').sortableTable({initialColumn: 4});
	$('#most-active-users').sortableTable({initialColumn: 4});

  function yoMomma() {
    var random=Math.floor(Math.random()*1192);
    $.get('/yomomma/'+random+'/', {}, function(html) {
      var joke = $(html).find('font[size=5]')[0].innerText;
      $('#yomomma').text(joke);
    });
  };

  function chuckNorris() {
    $.get('http://api.icndb.com/jokes/random', {}, function(data) {
      data = JSON.parse(data);
      if(data.type !=="success") return false;
      $('#chucknorris').text(data.value.joke);
    });
  };

  yoMomma();
  chuckNorris();
</script>
{% endblock %}
